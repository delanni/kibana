$schema: https://moonrepo.dev/schemas/project.json

fileGroups:
  sharedGlobals: [ ]
  default:
    - '**/*'
  production: [ ]
  src:
    - 'src/**/*'

tasks:
  greet:
    deps:
      - ^:greet
    script: echo "Hello from $MOON_PROJECT_ROOT!"
  jest:
    description: Run jest tests
    command: node
    options:
      runFromWorkspaceRoot: true
      mergeArgs: append
    args:
      - scripts/jest.js
      - '--cache'
      - '--passWithNoTests'
  jestCI:
    description: Run jest tests (in band)
    command: node
    options:
      runFromWorkspaceRoot: true
      mergeArgs: append
    args:
      - scripts/jest.js
      - '--passWithNoTests'
      - '--runInBand'
  lint:
    command: node
    args:
      - $workspaceRoot/scripts/eslint.js
      - $projectRoot
      - '--no-error-on-unmatched-pattern'
    options:
      runFromWorkspaceRoot: true
    inputs:
      # Source and test files
      - 'src/**/*'
      - 'tests/**/*'
      # Other config files
      - '*.config.*'
      # Project configs, any format, any depth
      - '**/.eslintrc.*'
      # Root configs, any format
      - '/.eslintignore'
      - '/.eslintrc.*'
  lint_with_types:
    options:
      runFromWorkspaceRoot: true
    command: node
    args:
      - $workspaceRoot/scripts/eslint_with_types.js
      - '--project'
      - $projectRoot/tsconfig.json
    env:
      NODE_OPTIONS: '--max-old-space-size=8192'
  genTypecheckConfig:
    script: "node $workspaceRoot/scripts/type_check.js --project $projectRoot/tsconfig.json --config-only"
    inputs:
      - "tsconfig.json"
    outputs:
      - "tsconfig.moon.json"
  typecheck:
    command:
      - 'tsc'
      - '--build'
      - 'tsconfig.moon.json'
      - '--pretty'
    inputs:
      - '@group(src)'
      - 'tsconfig.json'
      - 'tsconfig.*.json'
    outputs:
      - 'target'
    deps:
      - '@kbn/ts-type-check-cli:generateAllTypecheckConfigs'
      - '^:typecheck'
    options:
      runFromWorkspaceRoot: true
      mergeOutputs: replace
    env:
      NODE_OPTIONS: '--max-old-space-size=8192'
