tasks:
  print-stats:
    script: 'node -p "v8.getHeapStatistics().heap_size_limit / 1024 / 1024"'
    options:
      runFromWorkspaceRoot: true
      cache: false
    env:
      NODE_OPTIONS: '--max-old-space-size=9216'
  typecheck:
    command:
      - 'tsc'
      - '--build'
      - '$projectSource/tsconfig.moon.json'
      - '--pretty'
    inputs:
      - '@group(src)'
      - 'tsconfig.json'
      - 'tsconfig.*.json'
    outputs:
      - 'target'
    deps:
      - 'kibana:generateAllTypecheckConfigs'
      - '^:typecheck'
      - '~:print-stats'
    options:
      runFromWorkspaceRoot: true
      mergeOutputs: replace
      mergeArgs: replace
      mergeInputs: replace
    env:
      NODE_OPTIONS: '--max-old-space-size=9216'
